import{D as m,Q as v,r as p,j as n,H as u,L as x,X as b,Y as j,$ as g,R as T,N as w,_ as C,S as k,T as P,U as E,V as R,W as q,I as f}from"./index-2e6015fe.js";import{C as L}from"./Card-89e3a3b1.js";import{u as _}from"./useQuery-126fcc4d.js";import{u as S,b as M}from"./useToast-38e41910.js";import{g as A,u as F}from"./software-service-b79da66b.js";import{M as O}from"./Modal-e69a7e9c.js";import{a as U}from"./date-fns-2338d0ca.js";const Q=()=>{const{setLoading:l}=m(),{errorToast:e}=S();return _({queryKey:["softwares"],queryFn:()=>A(),onError:async o=>{e(o),l(!1)},onSettled:async()=>{l(!1)},refetchOnWindowFocus:!1,retry:!1})},V=()=>{const l=v(),{setLoading:e}=m(),{successToast:o,errorToast:s}=S();return M({mutationFn:r=>F(r),onMutate:()=>{e(!0)},onError:async r=>{e(!1),s(r)},onSuccess:async r=>{o(r),l.invalidateQueries({queryKey:["softwares"]})},onSettled:()=>{e(!1)}})},B=({isOpen:l,data:e,onDidDismiss:o})=>{const[s,r]=p.useState({}),{mutate:h}=V(),i=(t,a)=>{r(y=>({...y,[t]:a}))},d=t=>{r(a=>({...a,licenseType:t,startDate:"",expireDate:""}))},I=t=>{s.licenseType==="Subscription"?r(a=>({...a,startDate:t,expireDate:U(t,1)})):r(a=>({...a,startDate:t}))},c=t=>{t.preventDefault(),h(s),o()};return p.useEffect(()=>{r(t=>({...t,id:e==null?void 0:e.id,name:e==null?void 0:e.name,version:e==null?void 0:e.version,licenseType:e==null?void 0:e.licenseType,startDate:e==null?void 0:e.startDate,expireDate:e==null?void 0:e.expireDate,remark:e==null?void 0:e.remark,inActive:e==null?void 0:e.inActive}))},[e]),n.jsx(O,{title:"Update Software",isOpen:l,onDidDismiss:o,children:n.jsxs("form",{onSubmit:c,children:[n.jsx(u,{children:n.jsx(x,{type:"text",label:"Name",labelPlacement:"floating",value:s==null?void 0:s.name,onIonInput:t=>i("name",t.detail.value),required:!0})}),n.jsx(u,{children:n.jsx(x,{type:"text",label:"Version",labelPlacement:"floating",value:s==null?void 0:s.version,onIonInput:t=>i("version",t.detail.value),required:!0})}),n.jsx(u,{children:n.jsxs(b,{label:"License Type",labelPlacement:"floating",value:s==null?void 0:s.licenseType,onIonChange:t=>d(t.detail.value),children:[n.jsx(j,{value:"Subscription",children:"Subscription"}),n.jsx(j,{value:"Perpetual",children:"Perpetual"})]})}),n.jsx(u,{children:n.jsx(x,{type:"date",label:"Start Date / Purchase Date",labelPlacement:"floating",value:s==null?void 0:s.startDate,onIonInput:t=>I(t.detail.value),required:!0})}),n.jsx(u,{hidden:(s==null?void 0:s.licenseType)==="Perpetual",children:n.jsx(x,{type:"date",label:"Expire Date",labelPlacement:"floating",value:s==null?void 0:s.expireDate,onIonInput:t=>i("expireDate",t.detail.value)})}),n.jsx(u,{children:n.jsx(g,{label:"Remark",labelPlacement:"floating",value:s==null?void 0:s.remark,onIonInput:t=>i("remark",t.detail.value),required:!0})}),n.jsx(u,{children:n.jsx(T,{checked:s==null?void 0:s.inActive,onIonChange:t=>i("inActive",t.detail.checked),children:"InActive"})}),n.jsx(w,{type:"submit",expand:"block",children:"Submit"})]})})},D=p.lazy(()=>C(()=>import("./TableSoftware-8558f0bd.js"),["assets/TableSoftware-8558f0bd.js","assets/index-2e6015fe.js","assets/index-30953d8c.css","assets/Table-31cc959a.js","assets/date-fns-2338d0ca.js"])),X=()=>{const{data:l,isLoading:e,refetch:o}=Q(),[s,r]=p.useState(),[h,i]=p.useState(!1),d=c=>{r(c),i(!0)},I=async c=>{o(),c.detail.complete()};return n.jsxs(n.Fragment,{children:[n.jsx(k,{slot:"fixed",onIonRefresh:I,children:n.jsx(P,{})}),n.jsx(E,{children:n.jsx(R,{children:n.jsx(q,{children:n.jsx(L,{title:"Data Softwares",children:e?n.jsx(f,{name:"crescent"}):n.jsx(p.Suspense,{fallback:n.jsx(f,{name:"crescent"}),children:n.jsx(D,{data:l,handleClickBtnEdit:c=>d(c)})})})})})}),n.jsx(B,{data:s,isOpen:h,onDidDismiss:()=>i(!1)})]})};export{X as default};
